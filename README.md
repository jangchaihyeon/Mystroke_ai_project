# Mystroke_ai_project
뇌졸증 진단 프로젝트 웹사이트

이 프로젝트는 뇌졸중 자가진단을 위해 제작되었습니다.

웹 서버로 만들기에 어려움을 느껴 현재 로컬 서버로 접속 가능한 점 양해 부탁드립니다.

예측 모델 logistic -> CNN

1. 개발 환경
anaconda
visual studio code
python 3.12.5
python modules
flask 3.0.3
flask-cors 4.0.1
flask-login 0.6.3
flask-migrate 4.0.7
flask-sqlalchemy 3.1.1
flask-wtf 1.2.1
dlib 19.24.4
cmake 3.30.2
numpy 1.26.4
werkzeug 3.0.3
opencv-python 4.10.0.84
2. 설치 방법
1. 아나콘다 설치: 링크로 들어가서 아나콘다를 설치해 주세요.
2. Visual Studio Code 설치: 링크로 들어가서 VScode를 설치해 주세요.
3. Github의 파일을 다운로드 받고 ZIP 파일을 압축 풀어 주세요. 그 다음, VScode에 다운로드 받은 파일을 열어 주세요.
4. 다음 순서로 아나콘다 가상환경을 만들어 주세요.
1. VScode의 터미널을 열어 주세요.
2. VScode의 터미널에 다음을 입력해 주세요.
conda env create -f environment.yml

3. VScode의 터미널에 다음과 같은 문구가 떴다면 가상환경 설정이 완료된 것입니다.
image

+) 만약 dlib 오류가 난다면 링크를 따라해 주세요.
5. 마지막으로 app.py를 실행시켜 주세요.
3. 탭별 소개
1. 로비 페이지
1. index.html: 로비 페이지의 뼈대를 이루는 html 파일
index.html을 열어보면 알겠지만 로그인 했을 때와 안 했을 때 열리는 로비가 다르다. 물론 디자인은 비슷하고 선택 가능한 탭이 약간 다를 뿐이다.
로그인하지 않았을 때 선택 가능한 탭: 로그인, 회원가입
로그인헀을 때 선택 가능한 탭: 로그아웃, 정보 수정, 자가진단-결과
2. index.css: 로비 페이지의 스타일을 담당하는 css 파일
2. 회원가입 페이지
1. signup.html: 회원가입 페이지의 뼈대를 이루는 html 파일
이메일과 비밀번호를 받아 회원가입이 가능하다. 입력한 정보는 instance/users.db에 저장되며, 처음 입력 시에는 id, email, password, username 등이 입력된다. 이때, id는 회원가입 순서대로 번호가 매겨지며 username은 이메일의 @ 앞에 쓰인 문자와 숫자를 입력받게 해 두었다. 만약 이 instance/users.db 파일이 궁금하다면 링크에 접속하여 볼 수 있다.
2. signup.css: 회원가입 페이지의 스타일을 담당하는 css 파일
3. 로그인 페이지
1. login.html: 로그인 페이지의 뼈대를 이루는 html 파일
로그인도 회원가입과 똑같이 이메일과 비밀번호를 받아 로그인이 가능하게 했다. 처음에 말했던 것과 같이 로그인 유무를 감지한다.
2. login.css: 로그인 페이지의 스타일을 담당하는 css 파일
4. 정보 수정 페이지
1. setting.html: 정보 수정 페이지의 뼈대를 이루는 html 파일
정보 수정 탭에 들어가면 나이, 성별, 혈압(최고, 최저), 콜레스테롤 등을 입력할 수 있게 되어 있다. 이는 입력하면 instance/users.db로 들어가게 되며 이 또한 궁금하면 회원가입 탭에서 언급한 곳으로 가서 확인이 가능하다. 정보 수정 탭을 보면 알겠지만 혈압과 콜레스테롤 수치를 안다와 모른다로 선택지가 두 개인데, 안다를 골랐을 때 숫자를 입력할 수 있게 하고 모른다를 골랐을 때 숫자를 입력하지 못하게 한다. 이 또한 instance/users.db에 업로드된다.
2. setting.js
특이하게 얘만 javascript 파일이 따로 있는데, 혈압이랑 콜레스테롤 수치를 안다 또는 모른다를 감지하기 위해 작성된 파일이다.
5. 자가진단 페이지
1. upload.html: 자가진단 페이지의 뼈대를 이루는 html 파일
자가진단 페이지를 들어가 보면 알겠지만 사진을 업로드 할 수 있게 되어 있다. 사진 업로드를 하면 결과 페이지로 넘어가게 된다.
2. uploads
사용자가 입력한 사진을 저장받는 폴더이다. 사진을 업로드하고 서버 로그를 보면 알겠지만 "30초 후 uploads 파일이 리셋됩니다."라고 뜨는데, 이는 개인 정보인 사진을 서버에서 저장하지 않게 하기 위해 사진이 업로드 된 이후 결과만 반환하고 삭제하게 한 것이다. 물론 현재는 로컬 서버여서 큰 의미는 없다.
6. 결과 페이지
1. result.html: 결과 페이지의 뼈대를 이루는 html 파일
프로젝트의 주를 이루었던 페이지이다. 이 페이지가 실행되는 순서는 다음과 같다.
1. 사용자에게 사진을 입력받고 서버로 전송한다.
2. 서버에 저장된 사진으로 result.py를 돌린다.
3. result.py로 나온 결과를 다시 사용자에게 반환한다.
flask를 사용하지 않으면 서버와 내 파이썬 코드가 상호작용할 수 없어 flask를 사용하게 되었다.
2. result.py
사용자의 안면 이미지를 통해 뇌졸중을 예측하는 파이썬 코드이다. 안면 이미지에서 dlib으로 얼굴 점을 찍는다. 그 다음 왼쪽 눈 끝과 중심, 오른쪽 눈 끝과 중심, 왼쪽 코 끝과 중심, 오른쪽 코 끝과 중심, 왼쪽 입꼬리 끝과 중심, 오른쪽 입꼬리 끝과 중심의 거리를 계산하고 눈, 코, 입 각각의 비율을 내기 위해 나온 거리들을 (짧은 거리) / (먼 거리)로 계산한다. 이 비율을 train.py에서 나온 가중치와 편향을 통해 가공한 뒤, 시그모이드 함수에 넣어 뇌졸중 결과를 예측한다. 정리하자면 눈, 코, 입 비율을 로지스틱 회귀를 통해 뇌졸중 결과를 예측한다고 할 수 있겠다. 아쉬운 점은 아무래도 안면 인식 데이터를 구해야 하기 때문에 데이터가 너무나도 적고, 증명사진처럼 정면을 본 사진 위주로 학습할 수밖에 없어 웹에서 사용자가 이미지를 입력할 때 너무 활짝 웃는 사진이나 조금이라도 시선이 틀어진 사진을 업로드하면 오류가 날 확률이 높다는 것이다. 또, 데이터가 적다보니 정확도가 0.68 정도이며, 로그 손실 값이 0.62 정도로 데이터가 적은 모델에서 흔히 나오는 값이 나왔다.
7. 로그아웃
그냥 말 그대로 로그아웃이라 할 말이 없다. 음... 로그아웃을 하면 로비 페이지로 돌아온다.
* 기타
1. app.py
이 서버의 심장이라고 생각된다. 일단 페이지와 페이지를 잇는 역할과 사용자에게 입력받은 이미지를 저장했다가 결과가 나오면 삭제하는 것도 얘가 하고, 로그인 여부 확인도 얘가 한다. 또, 파이썬과 html을 연결해 주며, 위에 있는 설치 방법에도 나왔다시피 이걸 실행하면 로컬 서버를 열 수가 있다. 아, 그리고 꾸준히 언급되었던 user.db도 얘가 업데이트한다. 모듈 설명은 내가 하는 것보다 인터넷을 참고하는 것이 나을 것이다.
2. script.js
얘는 모든 html 파일에 사용되고 있는데, 그냥 오류 팝업창을 띄우는 애다. 제일 애를 많이 먹었던 것 중 하나이다.
3. style.css: 거의 모든 페이지의 스타일을 담당하는 css 파일
4. BaseFile
얘는 웹과 연결하기 전의 파이썬 파일이다. 만약에 train.py와 그 전의 result.py를 보고 싶다면 들어가 보면 좋을 것 같다. 이 안에 있는 train_data.txt가 첫 줄에 가중치, 그 다음 줄에 편향을 저장하고 있다. 주석을 꽤 자세하게 달았으니 모델 이해에 도움이 될 것 같다.
언급되지 않은 나머지는 몰라도 파일 돌리는데 지장이 없다.
